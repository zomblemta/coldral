<style>
  .popup-size-guide {
    display: none;
  }
  .popup-size-guide.active {
    display: flex;
  }
</style>

<div class="popup-size-guide w-full h-full bg-[#00000050] fixed top-0 left-0 z-[1000] flex flex-col justify-center items-center">
  <div class="popup-size-guide__content bg-white p-4 max-w-[80%] min-w-[40%]">
    <div class="popup-size-guide__content__title  flex justify-between items-center w-full">
      <h2 class="text-2xl font-bold text-black">Size Guide</h2>
      <span
        class="popup-size-guide__content__title__close w-[24px] h-[24px] cursor-pointer shrink-0"
        data-size-guide-close
      >
        {%- render 'icon', icon: 'icon-close-black', class: 'w-[24px] h-[24px] shrink-0' -%}
      </span>
    </div>
    <div class="popup-size-guide__content__content overflow-y-auto max-h-[80vh]">
      {%- liquid
        assign size_guide_metafield = product.metafields.custom.size_guide_pdf
        assign file_url = nil
        assign is_image = false
        
        if size_guide_metafield != blank
          assign metafield_value = size_guide_metafield.value | default: size_guide_metafield
          
          comment
            Check for MediaImage (image reference metafield)
          endcomment
          if metafield_value.src != blank
            assign file_url = metafield_value | image_url: width: 1200
            assign is_image = true
          elsif metafield_value.preview_image.src != blank
            assign file_url = metafield_value.preview_image | image_url: width: 1200
            assign is_image = true
          comment
            Check for GenericFile (file reference metafield)
          endcomment
          elsif metafield_value.url != blank
            assign file_url = metafield_value.url
            assign media_type = metafield_value.media_type | default: ''
            if media_type == 'image'
              assign is_image = true
            endif
          endif
        endif
      -%}
      {%- if file_url != blank -%}
        {%- if is_image or file_url contains '.jpg' or file_url contains '.jpeg' or file_url contains '.png' or file_url contains '.webp' or file_url contains '.gif' or file_url contains '.svg' -%}
          <img 
            src="{{ file_url }}" 
            alt="Size Guide"
            class="w-full h-auto"
            width="800"
            height="600"
            loading="lazy"
          >
        {%- else -%}
          <iframe 
            src="{{ file_url }}" 
            class="w-full h-[70vh] border-0"
            title="Size Guide"
          ></iframe>
        {%- endif -%}
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  (function () {
    // Use event delegation to handle dynamically added elements
    document.addEventListener('click', function (e) {
      // Handle size guide trigger clicks (works for dynamically added elements)
      if (e.target.closest('[data-size-guide-trigger]')) {
        const popupSizeGuide = document.querySelector('.popup-size-guide');
        if (popupSizeGuide) {
          popupSizeGuide.classList.add('active');
        }
      }

      // Handle size guide close clicks
      if (e.target.closest('[data-size-guide-close]')) {
        const popupSizeGuide = document.querySelector('.popup-size-guide');
        if (popupSizeGuide) {
          popupSizeGuide.classList.remove('active');
        }
      }
    });

    // Also handle clicks on the backdrop to close
    document.addEventListener('click', function (e) {
      const popupSizeGuide = document.querySelector('.popup-size-guide');
      if (popupSizeGuide && e.target === popupSizeGuide) {
        popupSizeGuide.classList.remove('active');
      }
    });
  })();
</script>
